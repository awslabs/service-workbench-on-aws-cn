"use strict";(self.webpackChunkservice_workbench_docusaurus=self.webpackChunkservice_workbench_docusaurus||[]).push([[5521],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return d}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=r,g=u["".concat(s,".").concat(d)]||u[d]||c[d]||a;return n?o.createElement(g,i(i({ref:t},m),{},{components:n})):o.createElement(g,i({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2766:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return m},default:function(){return u}});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),i=["components"],l={id:"configuring_idp",title:"Configuring an Identity Provider",sidebar_label:"Configuring an Identity Provider"},s=void 0,p={unversionedId:"deployment/configuration/auth/configuring_idp",id:"deployment/configuration/auth/configuring_idp",isDocsHomePage:!1,title:"Configuring an Identity Provider",description:"Service Workbench on AWS uses Amazon Cognito User Pools to federate identities from Microsoft Active Directory using ADFS and SAML2.0.",source:"@site/docs/deployment/configuration/auth/configuring_idp.md",sourceDirName:"deployment/configuration/auth",slug:"/deployment/configuration/auth/configuring_idp",permalink:"/service-workbench-on-aws-cn/deployment/configuration/auth/configuring_idp",editUrl:"https://github.com/awslabs/go-research-on-aws/website/docs/deployment/configuration/auth/configuring_idp.md",tags:[],version:"current",frontMatter:{id:"configuring_idp",title:"Configuring an Identity Provider",sidebar_label:"Configuring an Identity Provider"}},m=[{value:"Create a Relying Party (RP) in ADFS",id:"create-a-relying-party-rp-in-adfs",children:[],level:2},{value:"Configure Relying Party information on the Service Workbench side",id:"configure-relying-party-information-on-the-service-workbench-side",children:[],level:2},{value:"Add Relying Party trust for the Cognito User Pool on the ADFS side",id:"add-relying-party-trust-for-the-cognito-user-pool-on-the-adfs-side",children:[],level:2}],c={toc:m};function u(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Service Workbench on AWS uses Amazon Cognito User Pools to federate identities from Microsoft Active Directory using ADFS and SAML2.0."),(0,a.kt)("p",null,"For SAML federation, the Amazon Cognito User Pool is the Service Provider (SP). The SP processes SAML assertions and the ADFS is the Identity Provider (IdP). Mutual trust between the SP and the IdP must be established."),(0,a.kt)("h2",{id:"create-a-relying-party-rp-in-adfs"},"Create a Relying Party (RP) in ADFS"),(0,a.kt)("p",null,"These steps may vary based on your AD/ADFS version. Please contact your system administrator to configure a relying party and establish trust with Microsoft Active Directory."),(0,a.kt)("p",null,"To create a relying party, complete these steps:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Login to your Active Directory Domain Controller Machine. Type ",(0,a.kt)("inlineCode",{parentName:"li"},"AD FS")," in the \u2018",(0,a.kt)("strong",{parentName:"li"},"Run"),"\u2019 window and open \u2018",(0,a.kt)("strong",{parentName:"li"},"AD FS 2.0 Management"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},"Select \u2018",(0,a.kt)("strong",{parentName:"li"},"Add Relying Party Trust"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},"In the \u2018",(0,a.kt)("strong",{parentName:"li"},"Welcome"),"\u2019 screen, click \u2018",(0,a.kt)("strong",{parentName:"li"},"Start"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},"In the \u2018",(0,a.kt)("strong",{parentName:"li"},"Select Data Source"),"\u2019 pane, select \u2018",(0,a.kt)("strong",{parentName:"li"},"Enter Data About the Relying Party Manually"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},"In the \u2018",(0,a.kt)("strong",{parentName:"li"},"Specify Display Name"),"\u2019 pane, enter a display name and relevant notes about the relying party. For example, a user could enter in, \u2018",(0,a.kt)("strong",{parentName:"li"},"Cognito User Pool Relying Party"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},"In the \u2018",(0,a.kt)("strong",{parentName:"li"},"Choose Profile"),"\u2019 pane, select \u2018",(0,a.kt)("strong",{parentName:"li"},"AD FS 2.0 Profile"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("em",{parentName:"strong"},"DO NOT"))," configure any certificate in the \u2018",(0,a.kt)("strong",{parentName:"li"},"Configure Certificate"),"\u2019 pane. Configuring certificates is for encrypting SAML claims. The SP (i.e., the Amazon Cognito User Pool) will need a private key to decrypt the claims if you configure a certificate, and Amazon Cognito User Pools do not currently support encrypted SAML assertions."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("em",{parentName:"strong"},"DO NOT"))," select any box in the \u2018",(0,a.kt)("strong",{parentName:"li"},"Configure URL"),"\u2019 pane. Click \u2018",(0,a.kt)("strong",{parentName:"li"},"Next"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},"At this point, there is no need to configure anything in the \u2018",(0,a.kt)("strong",{parentName:"li"},"Configure Identifiers"),"\u2019 pane."),(0,a.kt)("li",{parentName:"ol"},"In the \u2018",(0,a.kt)("strong",{parentName:"li"},"Choose Issuance Authorization Rules"),"\u2019 pane, select \u2018",(0,a.kt)("strong",{parentName:"li"},"Permit All Users to Access this Relying Party"),"'."),(0,a.kt)("li",{parentName:"ol"},"In the \u2018",(0,a.kt)("strong",{parentName:"li"},"Ready to Add Trust"),"\u2019, click \u2018",(0,a.kt)("strong",{parentName:"li"},"Next"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},"In the \u2018",(0,a.kt)("strong",{parentName:"li"},"Finish"),"\u2019 pane, select \u2018",(0,a.kt)("strong",{parentName:"li"},"Close"),"\u2019."),(0,a.kt)("li",{parentName:"ol"},"Next, configure the attributes that you want for the SAML assertion. The attributes will be read by the Amazon Cognito User Pool and aligned to the standard Amazon Cognito Attributes from the mapping configuration in Amazon Cognito."),(0,a.kt)("li",{parentName:"ol"},"The \u2018",(0,a.kt)("strong",{parentName:"li"},"Edit Claims"),"\u2019 window may already be open from the last wizard. If not, you can open it by clicking the \u2018",(0,a.kt)("strong",{parentName:"li"},"Edit Claim Rules"),"\u2019 link and configure the claims. ")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Add the following claims:"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Name ID")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Name")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Mail")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Surname")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Given Name"))),(0,a.kt)("ol",{start:15},(0,a.kt)("li",{parentName:"ol"},"To add a ",(0,a.kt)("strong",{parentName:"li"},"Name ID")," claim:\n\u2013 Click \u2018",(0,a.kt)("strong",{parentName:"li"},"Add Rul"),"e\u2019.\n\u2013 Select \u2018",(0,a.kt)("strong",{parentName:"li"},"Transform an Incoming Claim"),"\u2019, then select \u2018",(0,a.kt)("strong",{parentName:"li"},"Next"),"\u2019 and then configure the claim."),(0,a.kt)("li",{parentName:"ol"},"Follow the same actions from ",(0,a.kt)("strong",{parentName:"li"},"Step 15")," to add the \u2018",(0,a.kt)("strong",{parentName:"li"},"Name"),"\u2019 claim."),(0,a.kt)("li",{parentName:"ol"},"To add the \u2018",(0,a.kt)("strong",{parentName:"li"},"E-Mail"),"\u2019 claim:\n\u2013 Select \u2018",(0,a.kt)("strong",{parentName:"li"},"Add Rule"),"\u2019.\n\u2013 Select \u2018",(0,a.kt)("strong",{parentName:"li"},"Send LDAP Attributes as Claims"),"\u2019, click \u2018",(0,a.kt)("strong",{parentName:"li"},"Next"),"\u2019 and then configure the claim."),(0,a.kt)("li",{parentName:"ol"},"Similarly, add the ",(0,a.kt)("strong",{parentName:"li"},"Surname")," and ",(0,a.kt)("strong",{parentName:"li"},"Given Name")," claims.")),(0,a.kt)("h2",{id:"configure-relying-party-information-on-the-service-workbench-side"},"Configure Relying Party information on the Service Workbench side"),(0,a.kt)("p",null,"Once you have created a ",(0,a.kt)("strong",{parentName:"p"},"Relying Party in ADFS"),", you can then configure it within the Service Workbench solution. Complete the following steps to configure the relying party. "),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Extract the SAML metadata file from ADFS. The location of the metadata file may be different depending upon your version of AD/ADFS. It is usually available at the following location:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"https://<DomainControllerDNSName>/FederationMetadata/2007-06/FederationMetadata.xml\n")),(0,a.kt)("ol",{start:2},(0,a.kt)("li",{parentName:"ol"},"Copy the above metadata file and place it at the following location: ")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/solution/post-deployment/config/saml-metadata/metadata.xml\n")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"Adjust your component specific settings file for the post-deployment component at the following location:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/solution/post-deployment/config/settings/<your-environment-name>.yml\n")),(0,a.kt)("ol",{start:4},(0,a.kt)("li",{parentName:"ol"},"Specify the ",(0,a.kt)("inlineCode",{parentName:"li"},"fedIdpMetadatas")," setting as follows:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"fedIdpMetadatas: '[\"s3://${self:custom.settings.namespace}-artifacts/saml-metadata/metadata.xml\"]'\n")),(0,a.kt)("h2",{id:"add-relying-party-trust-for-the-cognito-user-pool-on-the-adfs-side"},"Add Relying Party trust for the Cognito User Pool on the ADFS side"),(0,a.kt)("p",null,"Once you have deployed the solution, an Amazon Cognito User Pool will be created. Follow the steps below to add a ",(0,a.kt)("strong",{parentName:"p"},"Relying Party")," trust for the Amazon Cognito User Pool:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Log in to the AWS Management Console and navigate to Amazon Cognito."),(0,a.kt)("li",{parentName:"ol"},"Select \u2018",(0,a.kt)("strong",{parentName:"li"},"User Pool"),"\u2019 to see a ",(0,a.kt)("strong",{parentName:"li"},"User Pool")," for your environment. The name of the Amazon Cognito User Pool will be in the format below\u2014the ",(0,a.kt)("inlineCode",{parentName:"li"},"<envName>")," and the ",(0,a.kt)("inlineCode",{parentName:"li"},"<solutionName>")," values here would be the values you specified for the corresponding settings in your \u2018",(0,a.kt)("strong",{parentName:"li"},"Settings"),"\u2019 file.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"  <envName>-<solutionName>-userpool\n")),(0,a.kt)("ol",{start:3},(0,a.kt)("li",{parentName:"ol"},"Select the ",(0,a.kt)("strong",{parentName:"li"},"User Pool")," for your environment and take note of the following values:\n\u2013 ",(0,a.kt)("strong",{parentName:"li"},"User Pool ID"),": Copy the value for field ",(0,a.kt)("strong",{parentName:"li"},"Pool ID"),".\n\u2013 ",(0,a.kt)("strong",{parentName:"li"},"Domain Prefix"),": Navigate to \u2018",(0,a.kt)("strong",{parentName:"li"},"App Integration Domain Name"),"\u2019 for your ",(0,a.kt)("strong",{parentName:"li"},"User Pool")," and copy the value of the ",(0,a.kt)("strong",{parentName:"li"},"Domain Prefix"),"."),(0,a.kt)("li",{parentName:"ol"},"Login to your ADFS domain controller to add the Amazon Cognito User Pool-related information to configure trust.\n\u2013 Open the ADFS Management application.\n\u2013 Navigate to \u2018",(0,a.kt)("strong",{parentName:"li"},"Relying Party Trusts"),"\u2019.\n\u2013 To add trust, select the appropriate ",(0,a.kt)("strong",{parentName:"li"},"Relying Party"),".\n\u2013 Open the \u2018",(0,a.kt)("strong",{parentName:"li"},"Identifiers"),"\u2019 tab.\n\u2013 Enter the URN of the Amazon Cognito User Pool and click \u2018",(0,a.kt)("strong",{parentName:"li"},"Add"),"\u2019. Replace the ",(0,a.kt)("inlineCode",{parentName:"li"},"<userPoolId>")," with the value of the ",(0,a.kt)("strong",{parentName:"li"},"User Pool ID")," you obtained earlier. The URN is in the following format: ")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"urn:amazon:cognito:sp:<userPoolId>"),"\n\u2013 Open the \u2018",(0,a.kt)("strong",{parentName:"li"},"Endpoints"),"\u2019 tab and add the SP URL that will receive the SAML assertion from the IdP. The SP is the consumer of the Amazon Cognito SAML assertion. Replace ",(0,a.kt)("inlineCode",{parentName:"li"},"<userPoolDomain>")," with the value of the ",(0,a.kt)("strong",{parentName:"li"},"Domain Prefix")," you obtained earlier. Replace the value of ",(0,a.kt)("inlineCode",{parentName:"li"},"<region>")," with the region you deployed the solution. The URL is in the following format: ",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"https://<userPoolDomain>.auth.<region>.amazoncognito.com/saml2/idpresponse"))))),(0,a.kt)("p",null,"You should now be able to log in to the Service Workbench solution using your Active Directory credentials."))}u.isMDXComponent=!0}}]);