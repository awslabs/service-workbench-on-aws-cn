<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">Configuring an Identity Provider | Service Workbench Platform</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/service-workbench-on-aws-cn/deployment/configuration/auth/configuring_idp"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Configuring an Identity Provider | Service Workbench Platform"><meta data-react-helmet="true" name="description" content="Service Workbench on AWS uses Amazon Cognito User Pools to federate identities from Microsoft Active Directory using ADFS and SAML2.0."><meta data-react-helmet="true" property="og:description" content="Service Workbench on AWS uses Amazon Cognito User Pools to federate identities from Microsoft Active Directory using ADFS and SAML2.0."><link data-react-helmet="true" rel="shortcut icon" href="/service-workbench-on-aws-cn/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/service-workbench-on-aws-cn/deployment/configuration/auth/configuring_idp"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/service-workbench-on-aws-cn/deployment/configuration/auth/configuring_idp" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/service-workbench-on-aws-cn/deployment/configuration/auth/configuring_idp" hreflang="x-default"><link rel="stylesheet" href="/service-workbench-on-aws-cn/assets/css/styles.d97de6cb.css">
<link rel="preload" href="/service-workbench-on-aws-cn/assets/js/runtime~main.c80850b6.js" as="script">
<link rel="preload" href="/service-workbench-on-aws-cn/assets/js/main.ac3e2a5a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/service-workbench-on-aws-cn/"><b class="navbar__title">Home</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuring an Identity Provider</h1></header><p>Service Workbench on AWS uses Amazon Cognito User Pools to federate identities from Microsoft Active Directory using ADFS and SAML2.0.</p><p>For SAML federation, the Amazon Cognito User Pool is the Service Provider (SP). The SP processes SAML assertions and the ADFS is the Identity Provider (IdP). Mutual trust between the SP and the IdP must be established.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="create-a-relying-party-rp-in-adfs">Create a Relying Party (RP) in ADFS<a aria-hidden="true" class="hash-link" href="#create-a-relying-party-rp-in-adfs" title="Direct link to heading">â€‹</a></h2><p>These steps may vary based on your AD/ADFS version. Please contact your system administrator to configure a relying party and establish trust with Microsoft Active Directory.</p><p>To create a relying party, complete these steps:</p><ol><li>Login to your Active Directory Domain Controller Machine. Type <code>AD FS</code> in the â€˜<strong>Run</strong>â€™ window and open â€˜<strong>AD FS 2.0 Management</strong>â€™.</li><li>Select â€˜<strong>Add Relying Party Trust</strong>â€™.</li><li>In the â€˜<strong>Welcome</strong>â€™ screen, click â€˜<strong>Start</strong>â€™.</li><li>In the â€˜<strong>Select Data Source</strong>â€™ pane, select â€˜<strong>Enter Data About the Relying Party Manually</strong>â€™.</li><li>In the â€˜<strong>Specify Display Name</strong>â€™ pane, enter a display name and relevant notes about the relying party. For example, a user could enter in, â€˜<strong>Cognito User Pool Relying Party</strong>â€™.</li><li>In the â€˜<strong>Choose Profile</strong>â€™ pane, select â€˜<strong>AD FS 2.0 Profile</strong>â€™.</li><li><strong><em>DO NOT</em></strong> configure any certificate in the â€˜<strong>Configure Certificate</strong>â€™ pane. Configuring certificates is for encrypting SAML claims. The SP (i.e., the Amazon Cognito User Pool) will need a private key to decrypt the claims if you configure a certificate, and Amazon Cognito User Pools do not currently support encrypted SAML assertions.</li><li><strong><em>DO NOT</em></strong> select any box in the â€˜<strong>Configure URL</strong>â€™ pane. Click â€˜<strong>Next</strong>â€™.</li><li>At this point, there is no need to configure anything in the â€˜<strong>Configure Identifiers</strong>â€™ pane.</li><li>In the â€˜<strong>Choose Issuance Authorization Rules</strong>â€™ pane, select â€˜<strong>Permit All Users to Access this Relying Party</strong>&#x27;.</li><li>In the â€˜<strong>Ready to Add Trust</strong>â€™, click â€˜<strong>Next</strong>â€™.</li><li>In the â€˜<strong>Finish</strong>â€™ pane, select â€˜<strong>Close</strong>â€™.</li><li>Next, configure the attributes that you want for the SAML assertion. The attributes will be read by the Amazon Cognito User Pool and aligned to the standard Amazon Cognito Attributes from the mapping configuration in Amazon Cognito.</li><li>The â€˜<strong>Edit Claims</strong>â€™ window may already be open from the last wizard. If not, you can open it by clicking the â€˜<strong>Edit Claim Rules</strong>â€™ link and configure the claims. </li></ol><ul><li>Add the following claims:</li><li><strong>Name ID</strong></li><li><strong>Name</strong></li><li><strong>Mail</strong></li><li><strong>Surname</strong></li><li><strong>Given Name</strong></li></ul><ol start="15"><li>To add a <strong>Name ID</strong> claim:
â€“ Click â€˜<strong>Add Rul</strong>eâ€™.
â€“ Select â€˜<strong>Transform an Incoming Claim</strong>â€™, then select â€˜<strong>Next</strong>â€™ and then configure the claim.</li><li>Follow the same actions from <strong>Step 15</strong> to add the â€˜<strong>Name</strong>â€™ claim.</li><li>To add the â€˜<strong>E-Mail</strong>â€™ claim:
â€“ Select â€˜<strong>Add Rule</strong>â€™.
â€“ Select â€˜<strong>Send LDAP Attributes as Claims</strong>â€™, click â€˜<strong>Next</strong>â€™ and then configure the claim.</li><li>Similarly, add the <strong>Surname</strong> and <strong>Given Name</strong> claims.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configure-relying-party-information-on-the-service-workbench-side">Configure Relying Party information on the Service Workbench side<a aria-hidden="true" class="hash-link" href="#configure-relying-party-information-on-the-service-workbench-side" title="Direct link to heading">â€‹</a></h2><p>Once you have created a <strong>Relying Party in ADFS</strong>, you can then configure it within the Service Workbench solution. Complete the following steps to configure the relying party. </p><ol><li>Extract the SAML metadata file from ADFS. The location of the metadata file may be different depending upon your version of AD/ADFS. It is usually available at the following location:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">https://&lt;DomainControllerDNSName&gt;/FederationMetadata/2007-06/FederationMetadata.xml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="2"><li>Copy the above metadata file and place it at the following location: </li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/solution/post-deployment/config/saml-metadata/metadata.xml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="3"><li>Adjust your component specific settings file for the post-deployment component at the following location:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/solution/post-deployment/config/settings/&lt;your-environment-name&gt;.yml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="4"><li>Specify the <code>fedIdpMetadatas</code> setting as follows:</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fedIdpMetadatas: &#x27;[&quot;s3://${self:custom.settings.namespace}-artifacts/saml-metadata/metadata.xml&quot;]&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="add-relying-party-trust-for-the-cognito-user-pool-on-the-adfs-side">Add Relying Party trust for the Cognito User Pool on the ADFS side<a aria-hidden="true" class="hash-link" href="#add-relying-party-trust-for-the-cognito-user-pool-on-the-adfs-side" title="Direct link to heading">â€‹</a></h2><p>Once you have deployed the solution, an Amazon Cognito User Pool will be created. Follow the steps below to add a <strong>Relying Party</strong> trust for the Amazon Cognito User Pool:</p><ol><li>Log in to the AWS Management Console and navigate to Amazon Cognito.</li><li>Select â€˜<strong>User Pool</strong>â€™ to see a <strong>User Pool</strong> for your environment. The name of the Amazon Cognito User Pool will be in the format belowâ€”the <code>&lt;envName&gt;</code> and the <code>&lt;solutionName&gt;</code> values here would be the values you specified for the corresponding settings in your â€˜<strong>Settings</strong>â€™ file.</li></ol><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;envName&gt;-&lt;solutionName&gt;-userpool</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ol start="3"><li>Select the <strong>User Pool</strong> for your environment and take note of the following values:
â€“ <strong>User Pool ID</strong>: Copy the value for field <strong>Pool ID</strong>.
â€“ <strong>Domain Prefix</strong>: Navigate to â€˜<strong>App Integration Domain Name</strong>â€™ for your <strong>User Pool</strong> and copy the value of the <strong>Domain Prefix</strong>.</li><li>Login to your ADFS domain controller to add the Amazon Cognito User Pool-related information to configure trust.
â€“ Open the ADFS Management application.
â€“ Navigate to â€˜<strong>Relying Party Trusts</strong>â€™.
â€“ To add trust, select the appropriate <strong>Relying Party</strong>.
â€“ Open the â€˜<strong>Identifiers</strong>â€™ tab.
â€“ Enter the URN of the Amazon Cognito User Pool and click â€˜<strong>Add</strong>â€™. Replace the <code>&lt;userPoolId&gt;</code> with the value of the <strong>User Pool ID</strong> you obtained earlier. The URN is in the following format: </li></ol><ul><li><code>urn:amazon:cognito:sp:&lt;userPoolId&gt;</code>
â€“ Open the â€˜<strong>Endpoints</strong>â€™ tab and add the SP URL that will receive the SAML assertion from the IdP. The SP is the consumer of the Amazon Cognito SAML assertion. Replace <code>&lt;userPoolDomain&gt;</code> with the value of the <strong>Domain Prefix</strong> you obtained earlier. Replace the value of <code>&lt;region&gt;</code> with the region you deployed the solution. The URL is in the following format: <ul><li><code>https://&lt;userPoolDomain&gt;.auth.&lt;region&gt;.amazoncognito.com/saml2/idpresponse</code></li></ul></li></ul><p>You should now be able to log in to the Service Workbench solution using your Active Directory credentials.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/awslabs/go-research-on-aws/website/docs/deployment/configuration/auth/configuring_idp.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#create-a-relying-party-rp-in-adfs" class="table-of-contents__link toc-highlight">Create a Relying Party (RP) in ADFS</a></li><li><a href="#configure-relying-party-information-on-the-service-workbench-side" class="table-of-contents__link toc-highlight">Configure Relying Party information on the Service Workbench side</a></li><li><a href="#add-relying-party-trust-for-the-cognito-user-pool-on-the-adfs-side" class="table-of-contents__link toc-highlight">Add Relying Party trust for the Cognito User Pool on the ADFS side</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/service-workbench-on-aws-cn/assets/js/runtime~main.c80850b6.js"></script>
<script src="/service-workbench-on-aws-cn/assets/js/main.ac3e2a5a.js"></script>
</body>
</html>